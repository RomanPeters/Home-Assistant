alias: Set alarm
sequence:
  - alias: Set alarm
    service: input_select.select_option
    data_template:
      entity_id: input_select.alarm_time
      option: >
        {% if states.calendar.betaplanner.attributes.start_time[15] == '5' or states.calendar.betaplanner.attributes.start_time[15] == '0'Â  %}
        {{ ((strptime(states.calendar.betaplanner.attributes.start_time[11:16], "%H:%M") - strptime("1", "%H")) | string)[:-3] }}
        {% else %}
        {{ ((strptime(states.calendar.betaplanner.attributes.start_time[11:16], "%H:%M") - strptime("1", "%H")) | string)[:-4] }}0
        {% endif %}

  - alias: Turn on/off
    service_template: >
      {% if now().strftime("%Y-%m-%d") == states.calendar.betaplanner.attributes.start_time[:10] %}
      input_boolean.turn_on
      {% elif ((as_timestamp(strptime(now().strftime("%Y-%m-%d"), "%Y-%m-%d")) + 86400) | timestamp_local | string)[:10] == states.calendar.betaplanner.attributes.start_time[:10] %}
      input_boolean.turn_on
      {% else %}
      input_boolean.turn_off
      {% endif %}
    data:
      entity_id: input_boolean.smart_alarm