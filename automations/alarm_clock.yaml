# Notification happens through automations/notifications.yaml
# Home Status -> Home, happens through automations/set_home_status.yaml

# Set Alarm
- id: set_alarm_clock
  alias: 'Set Alarm Clock'
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_clock
      to: 'on'
    - platform: state
      entity_id: input_select.home_status
      to: 'Night'
  condition:
    - condition: state
      entity_id: input_boolean.alarm_clock
      state: 'on'
  action:
    - service: script.turn_on
      entity_id: script.set_alarm_clock

# Test Preview
- id: test_alarm_clock_action
  alias: 'Test Alarm Clock Action'
  trigger:
    - platform: state
      entity_id: input_select.alarm_clock_media
  action:
    - service: automation.trigger
      entity_id: automation.alarm_clock_media

# Action: Turn Off
- id: alarm_clock_turn_off
  alias: 'Alarm Clock Turn Off'
  trigger:
    - platform: template
      value_template: "{{ states('sensor.time') == (states.input_datetime.alarm_clock.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.alarm_clock

# Action: Climate
- id: alarm_clock_climate
  alias: 'Alarm Clock Climate'
  trigger:
    - platform: template
      value_template: "{{ states('sensor.time') == ((states.input_datetime.alarm_clock.attributes.timestamp | int - 1800) | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.home_status
          state: 'Night'
        - condition: state
          entity_id: input_select.home_status
          state: 'Home'
  action:
    - service: climate.turn_on
      entity_id: climate.thermostat

# Action: Lights
- id: alarm_clock_lights
  alias: 'Alarm Clock Lights'
  trigger:
    - platform: template
      value_template: "{{ states('sensor.time') == (states.input_datetime.alarm_clock.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"  
  condition:
    - condition: state
      entity_id: input_boolean.alarm_clock
      state: 'on'
  action:
    - service: scene.turn_on
      entity_id: scene.morning

# Action: Coffe
- id: alarm_clock_coffee
  alias: 'Alarm Clock Coffee'
  trigger:
    - platform: template
      value_template: "{{ (states('sensor.time') == (states.input_datetime.alarm_clock.attributes.timestamp | int - 480) | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.home_status
          state: 'Night'
        - condition: state
          entity_id: input_select.home_status
          state: 'Home'
    - condition: state
      entity_id: input_boolean.alarm_clock
      state: 'on'
  action:
    - service: switch.turn_on
      entity_id: switch.coffee_maker

# Action: Media
- id: alarm_clock_media
  alias: 'Alarm Clock Media'
  trigger:
    - platform: template
      value_template: "{{ states('sensor.time') == (states.input_datetime.alarm_clock.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: state
      entity_id: input_boolean.alarm_clock
      state: 'on'
  action:
    - service: script.turn_on
      data_template:
        entity_id: "script.play_url_{{ states('input_select.alarm_clock_sound').replace(' ', '_') | lower }}"

