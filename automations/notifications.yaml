# Boot
- id: notification_boot
  alias: Notification Boot
  trigger:
    - platform: homeassistant
      event: start
  action:
    - service: script.broadcast
      data:
        message: "Home Assistant is online"

# # iPhone Status
# - id: notification_iphone_status
#   alias: Notification iPhone Status
#   trigger:
#     - platform: state
#       entity_id: sensor.iphone_8_battery_state
#       from: Unplugged
#     - platform: state
#       entity_id: sensor.iphone_8_battery_state
#       to: Unplugged
#   action:
#     - service: notify.notify
#       data_template:
#         message: "Your iPhone 8 is {{ states('sensor.iphone_8_battery_state') | lower }}."

# Device tracker
- id: notification_new_device
  alias: Notification New Device
  trigger:
    platform: event
    event_type: device_tracker_new_device
  action:
    - service: notify.notify
      data_template:
        message: >
          {% if trigger.event.data.host_name %}
            {{ trigger.event.data.host_name }}
          {% else %}
            {{ trigger.event.data.mac }}
          {% endif %}
        title: New device

# Keys left at home
- id: keys_left_in_room
  alias: Keys Left in Room
  trigger:
    - platform: state
      entity_id: device_tracker.tile
      to: 'home'
      from: 'not_home'
  action:
    - service: notify.notify
      data:
        message: "Your keys are still in your room"


# Helmet BT
- id: helmet_bt_still_on
  alias: Helmet BT still on
  trigger:
    - platform: state
      entity_id: device_tracker.mh01
      to: 'home'
      for:
        minutes: 5
  action:
    - service: script.broadcast
      data:
        message: "Your helmet's bluetooth headset is still active, but not connected"

# Low battery
- id: notification_low_battery
  alias: Notification Low Battery
  trigger:
    - platform: numeric_state
      entity_id: sensor.aqara_button     
      value_template: '{{ state.attributes.battery }}'
      below: 11
    - platform: numeric_state
      entity_id: sensor.aqara_illuminance
      value_template: '{{ state.attributes.battery }}'
      below: 11
    - platform: numeric_state
      entity_id: sensor.aqara_temperature    
      value_template: '{{ state.attributes.battery }}'
      below: 11
    - platform: numeric_state
      entity_id: sensor.aqara_temperature_2
      value_template: '{{ state.attributes.battery }}'
      below: 11
    - platform: numeric_state
      entity_id: sensor.mijia_switch       
      value_template: '{{ state.attributes.battery }}'
      below: 11
  action:
    - service: persistent_notification.create
      data_template:
        message: "{{ state_attr(trigger.entity_id, 'friendly_name') }} {{ trigger.entity_id.split('.')[0] }} is at {{ state_attr(trigger.entity_id, 'battery') | int }}% battery."
        title: "Battery warning"

- id: notification_low_battery_mi_flora
  alias: Notification Low Battery Mi Flora
  trigger:
    - platform: numeric_state
      entity_id: sensor.mi_flora_battery
      below: 11
  action:
    - service: persistent_notification.create
      data_template:
        message: "Plant sensor is at {{ states('sensor.mi_flora_battery') | int }}% battery."
        title: "Battery warning"

# zigbee2mqtt
- id: notification_zigbee2mqtt
  alias: Notification zigbee2mqtt
  trigger:
    - platform: mqtt
      topic: zigbee2mqtt/bridge/log
  action:
    - service: notify.notify
      data_template:
        title: "zigbee2mqtt: {{ trigger.payload_json['type'] }}"
        message: "{{ trigger.payload_json['message'] | capitalize }}"

# PostNL
- id: notification_postnl
  alias: Notification PostNL
  trigger: 
    - platform: state
      entity_id: sensor.postnl
  action:
    - service: notify.notify
      data_template:
        title: "PostNL"
        message: "{{ trigger.to_state }}"

# transmission
- id: notification_torrent_complete
  alias: Notification Torrent Complete
  trigger:
    platform: event
    event_type: transmission_downloaded_torrent
  action:
    service: script.broadcast
    data_template:
      title: "Download Completed"
      message: "{{ trigger }}"

# minecraft
- id: notification_joined_minecraft
  alias: Notification Joined Minecraft
  trigger: 
    - platform: template
      value_template: "{{ 'joined the game' in states('sensor.minecraft_log') or 'left the game' in states('sensor.minecraft_log') }}"
  action:
    service: script.broadcast
    data_template:
      title: "Minecraft Server"
      message: "{{ states('sensor.minecraft_log') }}"

- id: notification_minecraft_server
  alias: Notification Minecraft Server
  trigger: 
    - platform: state
      entity_id: sensor.minecraft_server
  action:
    service: script.broadcast
    data_template:
      title: "Minecraft Server"
      message: "Server turned {{ trigger.to_state }}"
