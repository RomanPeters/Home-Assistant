# Home
- id: set_home_status_to_home_by_door
  alias: Set Home Status to home by door
  trigger:
    - platform: state
      entity_id: binary_sensor.door
      to: 'on'
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: 'Away'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home
    - service: timer.start
      entity_id: timer.wait_for_presence

- id: set_home_status_to_home
  alias: Set Home Status to home
  trigger:
    - platform: state
      entity_id: group.presence
      to: home
  condition:
    - condition: template
      value_template: "{{ not is_state('input_select.home_status', 'Off') }}"
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home
    - service: timer.cancel
      entity_id: timer.wait_for_presence

- id: home_status_to_home_from_night_by_motion  
  alias: Home Status to Home from Night by Motion
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor
      to: 'on'
  condition:
    - condition: time
      after: '09:00:00'
      before: '21:00:00'
    - condition: state
      entity_id: input_select.home_status
      state: 'Night'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home

- id: set_home_status_to_home_from_night_by_alarm_clock
  alias: Set Home Status to home from night by alarm clock
  trigger:
    - platform: template
      value_template: "{{ states('sensor.time') == (states.input_datetime.alarm_clock.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: Night
    - condition: state
      entity_id: input_boolean.alarm_clock
      state: 'on'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home

- id: set_home_status_to_home_from_night
  alias: Set Home Status to home from night
  trigger:
    - platform: state
      entity_id: sensor.iphone_8_battery_state
      to: Unplugged
    - platform: numeric_state
      entity_id: sensor.illuminance
      above: 7
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: Night
    - condition: time
      after: '07:00:00'
      before: '21:00:00'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home

# Away
- id: set_home_status_to_away
  alias: Set Home Status to away
  trigger: 
    - platform: state
      entity_id: group.presence
      to: not_home
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: Home
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Away
    - service: timer.cancel
      entity_id: timer.wait_for_presence

# Night
- id: set_home_status_to_night
  alias: Set Home Status to night
  trigger:
    - platform: time
      at: "01:00:00"
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: Home
    - condition: time
      after: '21:00:00'
      before: '00:00:00'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Night

- id: set_home_status_to_night_late_at_night
  alias: Set Home Status to night, late at night
  trigger:
    - platform: state
      entity_id: device_tracker.macbook_pro
      to: 'not_home'
    - platform: state
      entity_id: group.room_lights
      to: 'off'
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: Home
    - condition: time
      after: '00:00:00'
      before: '07:00:00'
  action:
    - wait_template: "{{ is_state('device_tracker.macbook_pro', 'not_home') }}"
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Night


# Home/Away
- id: correct_home_status 
  alias: Correct Home Status 
  trigger:
    - platform: event
      event_type: timer.finished
      event_data: 
        entity_id: timer.wait_for_presence
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.home_status
        option: >   
          {% if is_state('group.presence', 'home') %}
            Home
          {% else %}
            Away
          {% endif %}


