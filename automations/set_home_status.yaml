# Home
- id: set_home_status_to_home_by_door
  alias: Set Home Status to home by door
  trigger:
    - platform: state
      entity_id: binary_sensor.door
      to: 'on'
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: 'Away'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home
    - service: timer.start
      entity_id: timer.wait_for_presence

- id: set_home_status_to_home
  alias: Set Home Status to home
  trigger:
    - platform: state
      entity_id: group.presence
      to: home
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home
    - service: timer.cancel
      entity_id: timer.wait_for_presence

- id: set_home_status_to_home_from_night
  alias: Set Home Status to home from night
  trigger:
    - platform: template
      value_template: "{{ states('sensor.time') == (states.input_datetime.alarm_clock.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: Night
    - condition: state
      entity_id: input_boolean.alarm_clock
      state: 'on'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Home


# Away
- id: set_home_status_to_away
  alias: Set Home Status to away
  trigger: 
    - platform: state
      entity_id: group.presence
      to: not_home
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Away
    - service: timer.cancel
      entity_id: timer.wait_for_presence

# Night
- id: set_home_status_to_night
  alias: Set Home Status to night
  trigger:
    - platform: state
      entity_id: device_tracker.macbook_pro
      to: 'not_home'
    - platform: time
      at: "01:00:00"
  condition:
    - condition: state
      entity_id: input_select.home_status
      state: Home
    - condition: time
      after: '21:00:00'
      before: '07:00:00'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_status
        option: Night


# Home/Away
- id: correct_home_status 
  alias: Correct Home Status 
  trigger:
    - platform: state
      entity_id: input_select.home_status
      to: Night
      for:
        hours: 10
    - platform: event
      event_type: timer.finished
      event_data: 
        entity_id: timer.wait_for_presence
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.home_status
        option: >   
          {% if is_state('group.presence', 'home') %}
            Home
          {% else %}
            Away
          {% endif %}
