# When spoken notifications is turned on
# notifications will be played over the speakers with TTS if:
# someone is in the room and the door is closed 
# else the notification will be sent as a push notification on mobile


input_boolean:
  spoken_notifications:
    name: Spoken Notifications
    icon: mdi:voice

script:
  broadcast: 
    alias: Broadcast
    sequence:
      - alias: Choose method
        service_template: >
          {% if is_state('input_boolean.room_presence', 'on') and is_state('input_boolean.spoken_notifications', 'on') and is_state('binary_sensor.door', 'off') %}
            script.announce
          {% else %}
            script.notificate
          {% endif %}
        data_template:
            title: "{{ title }}"
            message: "{{ message }}"

  notificate:
    alias: Notificate
    sequence: 
      - alias: Send Notification
        service: notify.notify
        data_template:
          title: "{{ title }}"
          message: "{{ message }}"

  announce:
    alias: Announce
    sequence:
      - alias: Play Sound Effect
        service: media_player.play_media
        data:
          entity_id: media_player.intel_nuc
          media_content_type: "music"
          media_content_id: "/config/audio/sound_effects/Ping.aiff"
      - delay:
          seconds: 0.5
      - alias: Play Message
        service: tts.google_translate_say
        data_template:
          entity_id: media_player.intel_nuc
          message: "{{ message }}"
      
